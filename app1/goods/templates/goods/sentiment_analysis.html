<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <title>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –Ω–µ—Ä—É—Ö–æ–º–æ—Å—Ç—ñ</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f9;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 30px;
      }
      h1 {
        color: #333;
      }
      form {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        width: 500px;
        max-width: 90%;
      }
      textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-top: 5px;
        margin-bottom: 10px;
      }
      button {
        background-color: #3b82f6;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background-color: #2563eb;
      }
      .property {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
        padding: 15px;
        width: 600px;
        max-width: 95%;
      }
      .property img {
        width: 100%;
        border-radius: 10px;
      }
      .message {
        color: #555;
        font-style: italic;
        margin-top: 15px;
      }
      .analyze-btn {
        background-color: #10b981;
        margin-top: 10px;
      }
      .analyze-btn:hover {
        background-color: #059669;
      }
      .results {
        background: #fff;
        padding: 12px;
        border-radius: 8px;
        max-width: 800px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>–ù–µ—Ä—É—Ö–æ–º—ñ—Å—Ç—å, —è–∫–∞ –º–æ–∂–µ –≤–∞–º —Å–ø–æ–¥–æ–±–∞—Ç–∏—Å—è üè°</h1>

    <form method="POST">
      {% csrf_token %}
      <label for="preferences">–û–ø–∏—à—ñ—Ç—å, —â–æ –≤–∏ —à—É–∫–∞—î—Ç–µ:</label>
      <textarea
        name="preferences"
        id="preferences"
        rows="3"
        placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –•–æ—á—É –∫–≤–∞—Ä—Ç–∏—Ä—É –∑ –¥–≤–æ–º–∞ –∫—ñ–º–Ω–∞—Ç–∞–º–∏ –≤ —Ü–µ–Ω—Ç—Ä—ñ –¥–æ 15000 –≥—Ä–Ω"
      >
{{ user_query }}</textarea
      >
      <button type="submit">–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏</button>
    </form>

    {% if message %}
    <p class="message">{{ message }}</p>
    {% endif %} {% if recommendations %} {% for product in recommendations %}
    <div class="property">
      <h3>{{ product.name }}</h3>
      {% if product.image %}
      <img src="{{ product.image.url }}" alt="{{ product.name }}" />
      {% endif %}
      <p><b>–ê–¥—Ä–µ—Å–∞:</b> {{ product.quantity }}</p>
      <p><b>–ö—ñ–º–Ω–∞—Ç–∏:</b> {{ product.rooms }}</p>
      <p><b>–ü–ª–æ—â–∞:</b> {{ product.discount }} –º¬≤</p>
      <p><b>–¶—ñ–Ω–∞:</b> {{ product.price }} –≥—Ä–Ω</p>
      <p><b>–û–ø–∏—Å:</b> {{ product.description }}</p>

      <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –≤—ñ–¥–≥—É–∫—ñ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –∫–≤–∞—Ä—Ç–∏—Ä–∏ -->
      <a href="{% url 'goods:analyze_reviews' product.slug %}">
        <button class="analyze-btn">–ê–Ω–∞–ª—ñ–∑ –≤—ñ–¥–≥—É–∫—ñ–≤ üß†</button>
      </a>
    </div>
    {% endfor %} {% endif %} {% if detailed_predictions %}
    <!--<h3 style="margin-top: 15px">
      –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ
    </h3>-->

    <p style="font-weight: bold; color: #444; margin-bottom: 10px">
      –í—Å—å–æ–≥–æ –≤—ñ–¥–≥—É–∫—ñ–≤: {{ detailed_predictions|length }}
    </p>

    {% endif %} {% if chart_base64 %}
    <img
      src="data:image/png;base64,{{ chart_base64 }}"
      alt="–ì—Ä–∞—Ñ—ñ–∫ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ"
      style="max-width: 600px; width: 100%; margin-top: 15px"
    />
    {% endif %}
    <div class="results">
      {% for txt, label, prob in detailed_predictions %}
      <p style="margin: 8px 0">
        <b>–í—ñ–¥–≥—É–∫:</b> {{ txt|truncatechars:120 }} <br />
        <b>‚Üí –ü—Ä–æ–≥–Ω–æ–∑:</b> {{ label }} ({{ prob|floatformat:2 }})
      </p>
      <hr style="border: none; border-top: 1px solid #eee; margin: 6px 0" />
      {% endfor %}
    </div>
  </body>
</html>
